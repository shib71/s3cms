{"version":3,"sources":["src/app/store/actions.js"],"names":[],"mappings":"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","file":"src/app/store/actions.js","sourcesContent":["import { BEGINLOGIN, CANCELLOGIN, LOGIN, LOGOUT, SETPREFERENCE, DELETEPREFERENCE } from \"app/store/types\";\nimport Config from \"/s3cms_project/config.js\";\nimport 'aws';\n\nconst creds = new AWS.CognitoIdentityCredentials({\n    IdentityPoolId: Config.aws.identityPoolId\n});\nAWS.config.update({\n    region: Config.aws.cognitoRegion,\n    credentials: creds\n});\n\nconst bucket = new AWS.S3({\n\tparams: {\n\t\tBucket: Config.aws.bucket\n\t},\n\tregion: Config.aws.region\n});\n\nexport function beginLogin(provider, info) {\n\treturn {\n\t\ttype: BEGINLOGIN,\n\t\tprovider: provider,\n\t\tinfo: info\n\t}\n}\n\nexport function finalizeLogin(provider, id, name, email) {\n\treturn function (dispatch) {\n\t\tdispatch(beginLogin(provider, \"Confirming login with AWS\"));\n\n\t\tcreds.params.Logins = {};\n\t\tcreds.params.Logins[provider] = id;\n\t\t \n\t\t// Explicity expire credentials so they are refreshed\n\t\t// on the next request.\n\t\tcreds.expired = true;\n\n\t\tcreds.refresh(function(err){\n\t\t\tif (err){\n\t\t\t\tdispatch(cancelLogin(provider, err.toString()));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatch(beginLogin(provider, \"Checking permissions\"));\n\n\t\t\tbucket.getObject({\n\t\t\t\tKey: \"s3cms_project/permission_test.txt\"\n\t\t\t}, function(err, data){\n\t\t\t\tif (err.code === \"AccessDenied\"){\n\t\t\t\t\tdispatch(login(provider, creds.identityId, name, email, false));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (err){\n\t\t\t\t\tdispatch(cancelLogin(provider, err.toString()));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdispatch(login(provider, creds.identityId, name, email, true));\n\t\t\t});\n\t\t});\n\t};\n}\n\nexport function cancelLogin(provider, reason) {\n\treturn {\n\t\ttype: CANCELLOGIN,\n\t\tprovider: provider,\n\t\treason: reason\n\t}\n}\n\nexport function login(provider, id, name, email, admin) {\n  return {\n    type: LOGIN,\n    provider: provider,\n    id: id,\n    name: name,\n    email: email,\n    admin: admin\n  };\n}\n\nexport function logout(){\n\treturn {\n\t\ttype: LOGOUT\n\t};\n}\n\nexport function setPreference(key, value) {\n\treturn {\n\t\ttype: SETPREFERENCE,\n\t\tkey: key,\n\t\tvalue: value\n\t}\n}\n\nexport function deletePreference(key, value) {\n\treturn {\n\t\ttype: DELETEPREFERENCE,\n\t\tkey: key\n\t}\n}"]}